<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quest — Explore Darjeeling | YNG LITE Retreat 2025</title>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#94cb3c; --secondary:#023a5b; --accent:#fff;
    --text-dark:#333; --text-light:#666;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Poppins',sans-serif; background: linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); min-height:100vh;}
  .navbar{background:var(--secondary); position:fixed; width:100%; top:0; z-index:1000; box-shadow:0 2px 10px rgba(0,0,0,0.1)}
  .navbar a{color:var(--accent); padding:16px 20px; text-decoration:none; display:inline-block}
  .navbar a:hover, .navbar a.active{background:var(--primary); color:var(--secondary)}
  .header-section{background:linear-gradient(135deg,var(--secondary) 0%,#034a73 100%); color:var(--accent); padding:100px 20px 60px; text-align:center; margin-top:48px;}
  .header-section h1{font-size:2.2em; font-weight:700}
  .main-content{max-width:1100px; margin:40px auto; padding:20px}
  .quest-grid{display:grid; grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-top:20px}
  .quest-card{background:var(--accent); border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.08); border:3px solid transparent; transition:all 0.25s}
  .quest-card:hover{transform:translateY(-6px)}
  .level-number{background:var(--secondary); color:var(--accent); padding:10px 14px; border-radius:999px; font-weight:700; display:inline-block}
  .riddle{margin:15px 0; color:var(--text-dark); line-height:1.5}
  .small-hint{color:var(--text-light); font-size:0.95em; margin-bottom:12px}
  .masked {font-family:monospace; font-size:1.05em; letter-spacing:1px; background:#f6f8fa; padding:8px 10px; border-radius:8px; display:inline-block}
  .reveal-row{display:flex; gap:10px; align-items:center; margin-top:12px}
  .btn{padding:10px 14px; border-radius:8px; background:var(--primary); color:var(--secondary); border:none; cursor:pointer; font-weight:600}
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .full-name{font-weight:700; color:var(--secondary); margin-left:8px}
  .found-badge{color:green; font-weight:700; display:inline-flex; align-items:center; gap:8px}
  .quest-locked {position:fixed; inset:0; background:rgba(2,58,91,0.88); color:var(--accent); display:flex; align-items:center; justify-content:center; z-index:2000; flex-direction:column; padding:20px; text-align:center}
  .countdown{font-size:1.6em; margin-top:12px; font-weight:700}
  .unlock-note{opacity:.9; margin-top:8px}
  /* small */
  @media(max-width:600px){.header-section{padding:80px 12px 40px}}
</style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
  <a href="index.html"><i class="fas fa-home"></i> Home</a>
  <a href="schedule.html"><i class="fas fa-calendar-alt"></i> Schedule</a>
  <a href="groups.html"><i class="fas fa-users"></i> Groups</a>
  <a href="quest.html" class="active"><i class="fas fa-compass"></i> Quest</a>
</div>

<!-- Header -->
<div class="header-section">
  <h1><i class="fas fa-compass"></i> Explore Darjeeling — Quest</h1>
  <p>Arcade-style exploration: find the landmarks, tick them off, and unlock your adventure badges.</p>
</div>

<!-- Main -->
<div class="main-content">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
    <div>
      <h3 style="color:var(--secondary)">How this Quest works</h3>
      <p style="color:var(--text-light)">Each level shows a playful riddle + a masked first hint. When you find the place in real life, tap the ✓ button to mark it as found — the full name will be revealed.</p>
    </div>
    <div style="text-align:right;color:var(--text-light);">
      <div style="font-weight:700;color:var(--secondary)">Quest locked until:</div>
      <div id="unlockInfo" style="font-weight:600">—</div>
    </div>
  </div>

  <div class="quest-grid" id="questGrid">
    <!-- Cards inserted by JS -->
  </div>
</div>

<!-- Locked overlay (shown while locked) -->
<div class="quest-locked" id="lockedOverlay" style="display:none">
  <div style="max-width:560px">
    <h2 style="margin-bottom:8px"><i class="fas fa-lock"></i> Quest Locked</h2>
    <div id="countdownLarge" class="countdown">Loading...</div>
    <div class="unlock-note">This Quest will open on <strong>7 Nov 2025 — 2:15 PM IST</strong>. Come back then to begin exploring!</div>
    <div style="margin-top:18px">
      <button onclick="location.reload()" class="btn">Refresh when unlocked</button>
    </div>
  </div>
</div>

<script>
/* =========================================================
   Configuration: target unlock in IST (2025-11-07 14:15 IST)
   Convert to UTC ISO string: 2025-11-07T08:45:00Z
   ========================================================= */
const TARGET_UNLOCK_ISO_UTC = '2025-11-07T08:45:00Z'; // 7 Nov 2025 14:15 IST
const targetDate = new Date(TARGET_UNLOCK_ISO_UTC);

/* Quest data: your riddles + full canonical names */
const QUEST_POINTS = [
  {
    level:1,
    title:"The Sign of Hope",
    riddle:`Up the road of cakes and chatter,
Where travellers sip dreams that matter.
A four-letter word shines bright and fine,
Find the place that bakes hope into every line.`,
    hintText:"The air smells like coffee and croissants.",
    name:"Glenary's Hope Sign"
  },
  {
    level:2,
    title:"The Poet Who Spoke for All",
    riddle:`He gave words to gods in a language of men,
The Adikavi’s verse still echoes again.
Find the bronze that gazes afar,
Guarding the mall beneath the stars.`,
    hintText:"He’s the father of Nepali poetry.",
    name:"Bhanubhakta Statue"
  },
  {
    level:3,
    title:"The Whispering Church",
    riddle:`Bells that rang when the British prayed,
Still hum softly where silence stayed.
Go where stained glass meets the pine,
And peace feels almost divine.`,
    hintText:"Built in 1843, a quiet colonial church.",
    name:"St. Andrew's Church"
  },
  {
    level:4,
    title:"The Gate of Governors",
    riddle:`Past winding roads and regal grace,
Stands a gate to a forbidden place.
You can’t walk in, but you can admire,
The house where Bengal’s powers retire.`,
    hintText:"Near Richmond Hill; the official summer residence gate.",
    name:"Governor's House Gate"
  },
  {
    level:5,
    title:"The Gate of Colours and Prayers",
    riddle:`A dragon guards, the flags all sway,
Songs of Tibet light your way.
Seek the gate with colors bold,
Where crafts and hearts are centuries old.`,
    hintText:"A Tibetan school / refugee centre with traditional motifs.",
    name:"Tibetan School Gate"
  },
  {
    level:6,
    title:"The Clock of Time and Tales",
    riddle:`Tick-tock echoes through mist and street,
Where footsteps and stories forever meet.
The tower stands, a sentinel tall,
Watching the heart of the town for all.`,
    hintText:"An old clock tower near the town square.",
    name:"Darjeeling Clock Tower"
  }
];

/* Utility: generate a masked hint string.
   Approach: show every 3rd letter (for recognisable pattern), preserve punctuation/space.
   Example: "Glenary's Hope Sign" -> "G__n__y'_ H__e S_g_" (approx)
   This is intentionally a gentle reveal; you can tweak to show more/less letters.
*/
function maskName(name){
  let out = '';
  let letterIndex = 0;
  for(let ch of name){
    if(/[A-Za-z]/.test(ch)){
      // show every 3rd letter (index % 3 === 0), else underscore
      out += (letterIndex % 3 === 0) ? ch : '_';
      letterIndex++;
    } else {
      // preserve punctuation and spaces, do not increment letterIndex
      out += ch;
    }
    // add inter-letter separator for readability if you like (we keep plain)
  }
  return out;
}

/* Render the cards */
function renderQuestCards(){
  const container = document.getElementById('questGrid');
  container.innerHTML = QUEST_POINTS.map(point => {
    const masked = maskName(point.name);
    return `
      <div class="quest-card" data-level="${point.level}">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <span class="level-number">Level ${point.level}</span>
          <div style="color:var(--text-light);font-weight:600">${point.title}</div>
        </div>

        <div class="riddle" style="margin-top:12px;white-space:pre-line">${point.riddle}</div>
        <div class="small-hint"><i class="fas fa-lightbulb"></i> ${point.hintText}</div>

        <div style="margin-top:8px">
          <div class="masked" id="masked-${point.level}">${masked}</div>
        </div>

        <div class="reveal-row">
          <button class="btn" id="btn-${point.level}" onclick="markFound(${point.level})" title="Mark as found">✓ Found</button>
          <div id="reveal-${point.level}" style="display:inline-block"></div>
        </div>
      </div>
    `;
  }).join('');
}

/* Mark found: reveal full name and show a found badge; persist in localStorage */
function markFound(level){
  const point = QUEST_POINTS.find(p=>p.level===level);
  if(!point) return;
  // show full name
  const reveal = document.getElementById(`reveal-${level}`);
  reveal.innerHTML = `<span class="found-badge"><i class="fas fa-check-circle"></i> <span class="full-name">${point.name}</span></span>`;
  // disable button
  const btn = document.getElementById(`btn-${level}`);
  btn.disabled = true;
  btn.innerHTML = 'Found ✓';
  btn.style.background = '#d1ffd9';
  btn.style.color = '#055a1a';
  // update masked to show full name (replace masked element)
  const maskedEl = document.getElementById(`masked-${level}`);
  if(maskedEl) maskedEl.textContent = point.name;

  // persist state
  const state = JSON.parse(localStorage.getItem('questFound') || '{}');
  state[`level_${level}`] = true;
  localStorage.setItem('questFound', JSON.stringify(state));
}

/* Restore found states */
function restoreState(){
  const state = JSON.parse(localStorage.getItem('questFound') || '{}');
  for(const key in state){
    if(state[key]){
      const level = parseInt(key.split('_')[1]);
      // small timeout to ensure DOM exists
      setTimeout(()=> {
        const btn = document.getElementById(`btn-${level}`);
        if(btn){ btn.disabled = true; btn.innerHTML = 'Found ✓'; btn.style.background = '#d1ffd9'; btn.style.color = '#055a1a'; }
        const point = QUEST_POINTS.find(p=>p.level===level);
        const reveal = document.getElementById(`reveal-${level}`);
        if(reveal && point) reveal.innerHTML = `<span class="found-badge"><i class="fas fa-check-circle"></i> <span class="full-name">${point.name}</span></span>`;
        const maskedEl = document.getElementById(`masked-${level}`);
        if(maskedEl && point) maskedEl.textContent = point.name;
      }, 40);
    }
  }
}

/* Lock/unlock logic */

function updateLockUI(){
  const now = new Date();
  const lockedOverlay = document.getElementById('lockedOverlay');
  const countdownLarge = document.getElementById('countdownLarge');
  const unlockInfo = document.getElementById('unlockInfo');

  // show local friendly unlock time
  const options = { year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit', hour12:false, timeZoneName:'short' };
  unlockInfo.textContent = (new Date(targetDate)).toLocaleString(undefined, options);

  const diff = targetDate.getTime() - now.getTime();
  if(diff <= 0){
    // unlocked
    lockedOverlay.style.display = 'none';
    return true;
  } else {
    // locked
    lockedOverlay.style.display = 'flex';
    const days = Math.floor(diff / (1000*60*60*24));
    const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
    const minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
    const seconds = Math.floor((diff % (1000*60)) / 1000);
    countdownLarge.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    return false;
  }
}

/* initialize page */
document.addEventListener('DOMContentLoaded', function(){
  renderQuestCards();
  restoreState();
  updateLockUI();
  // update countdown every second
  setInterval(updateLockUI, 1000);
});
</script>

</body>
</html>
