<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quest ‚Äî Explore Darjeeling | YNG LITE Retreat 2025</title>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#94cb3c; --secondary:#023a5b; --accent:#fff;
    --text-dark:#333; --text-light:#666;
    --success:#10b981; --warning:#f59e0b; --danger:#ef4444;
  }
  
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Poppins',sans-serif; background: linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); min-height:100vh;}
  
  /* Navigation */
  .navbar{background:var(--secondary); position:fixed; width:100%; top:0; z-index:1000; box-shadow:0 2px 10px rgba(0,0,0,0.1)}
  .navbar a{color:var(--accent); padding:16px 20px; text-decoration:none; display:inline-block; transition:all 0.3s ease;}
  .navbar a:hover, .navbar a.active{background:var(--primary); color:var(--secondary)}
  
  /* Header */
  .header-section{background:linear-gradient(135deg,var(--secondary) 0%,#034a73 100%); color:var(--accent); padding:100px 20px 60px; text-align:center; margin-top:48px;}
  .header-section h1{font-size:2.2em; font-weight:700; margin-bottom:10px;}
  
  /* Main Content */
  .main-content{max-width:1100px; margin:40px auto; padding:20px}
  
  /* Instructions Section */
  .instructions-panel {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 2px solid #ffd43b;
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
  }
  
  .instructions-panel::before {
    content: 'üìã';
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 2em;
    opacity: 0.2;
  }
  
  .instructions-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
    color: var(--secondary);
  }
  
  .instructions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  
  .instruction-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 12px;
    background: rgba(255,255,255,0.7);
    border-radius: 10px;
  }
  
  .instruction-item i {
    color: var(--primary);
    margin-top: 2px;
  }
  
  /* Mountain Progress Visual */
  .mountain-progress {
    background: var(--accent);
    border-radius: 16px;
    padding: 25px;
    margin: 30px 0;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
  }
  
  .mountain-path {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    height: 120px;
    position: relative;
    margin-top: 20px;
  }
  
  .mountain-base {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: #e5e7eb;
    border-radius: 2px;
  }
  
  .checkpoint {
    position: relative;
    text-align: center;
    z-index: 2;
    flex: 1;
  }
  
  .checkpoint-dot {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: #e5e7eb;
    margin: 0 auto 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: var(--text-light);
    border: 3px solid var(--accent);
    transition: all 0.3s ease;
  }
  
  .checkpoint.active .checkpoint-dot {
    background: var(--primary);
    color: var(--secondary);
    transform: scale(1.1);
  }
  
  .checkpoint.completed .checkpoint-dot {
    background: var(--success);
    color: white;
  }
  
  .checkpoint-label {
    font-size: 0.85em;
    color: var(--text-light);
    font-weight: 600;
  }
  
  .mountain-peak {
    position: absolute;
    top: 0;
    right: 0;
    font-size: 2em;
    transform: translateY(-10px);
  }
  
  /* Achievement Badges */
  .badges-section {
    background: var(--accent);
    border-radius: 16px;
    padding: 25px;
    margin: 30px 0;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  }
  
  .badges-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  
  .badge {
    text-align: center;
    padding: 15px 10px;
    border-radius: 12px;
    background: #f8f9fa;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }
  
  .badge.locked {
    opacity: 0.5;
    filter: grayscale(1);
  }
  
  .badge.unlocked {
    background: linear-gradient(135deg, #f0fff4 0%, #e6ffed 100%);
    border-color: var(--success);
    transform: scale(1.05);
  }
  
  .badge-icon {
    font-size: 2em;
    margin-bottom: 8px;
    display: block;
  }
  
  .badge-name {
    font-size: 0.8em;
    font-weight: 600;
    color: var(--text-dark);
  }
  
  /* Enhanced Quest Cards */
  .quest-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 25px;
    margin-top: 30px;
  }
  
  .quest-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    border-left: 6px solid var(--primary);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  
  .quest-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(148, 203, 60, 0.1), transparent);
    transition: left 0.5s;
  }
  
  .quest-card:hover::before {
    left: 100%;
  }
  
  .quest-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
  }
  
  .quest-card.found {
    background: linear-gradient(135deg, #f0fff4 0%, #e6ffed 100%);
    border-left-color: var(--success);
  }
  
  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
  }
  
  .level-number {
    background: var(--secondary);
    color: var(--accent);
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.9em;
  }
  
  .difficulty {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: 600;
  }
  
  .difficulty.easy { background: #d1fae5; color: #065f46; }
  .difficulty.medium { background: #fef3c7; color: #92400e; }
  .difficulty.hard { background: #fee2e2; color: #991b1b; }
  
  .quest-title {
    color: var(--secondary);
    font-size: 1.3em;
    font-weight: 700;
    margin-bottom: 15px;
  }
  
  .riddle-box {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 12px;
    margin: 15px 0;
    border-left: 4px solid var(--primary);
  }
  
  .riddle {
    color: var(--text-dark);
    line-height: 1.6;
    white-space: pre-line;
    font-style: italic;
  }
  
  /* Progressive Hint System */
  .hint-system {
    margin: 15px 0;
  }
  
  .hint-toggle {
    background: none;
    border: none;
    color: var(--primary);
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 0;
  }
  
  .hint-content {
    background: #fff3cd;
    padding: 12px 15px;
    border-radius: 8px;
    margin-top: 8px;
    border-left: 4px solid #ffd43b;
    display: none;
  }
  
  .hint-content.show {
    display: block;
    animation: fadeIn 0.3s ease;
  }
  
  .hint-level {
    font-size: 0.8em;
    color: var(--warning);
    font-weight: 600;
    margin-bottom: 5px;
  }
  
  /* Location Reveal */
  .location-reveal {
    margin: 15px 0;
  }
  
  .masked-name {
    font-family: monospace;
    font-size: 1.1em;
    letter-spacing: 1px;
    background: #f6f8fa;
    padding: 10px 15px;
    border-radius: 10px;
    display: inline-block;
    border: 2px dashed #e5e7eb;
  }
  
  .found-btn {
    background: var(--primary);
    color: var(--secondary);
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .found-btn:hover:not(:disabled) {
    background: var(--secondary);
    color: var(--accent);
    transform: translateY(-2px);
  }
  
  .found-btn:disabled {
    background: var(--success);
    color: white;
    cursor: not-allowed;
  }
  
  .found-badge {
    color: var(--success);
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-left: 15px;
  }
  
  /* Locked Overlay */
.quest-locked {
    position: fixed;
    inset: 0;
    background: rgb(2, 58, 91);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    flex-direction: column;
    padding: 20px;
    text-align: center;
}

.quest-locked > div {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    max-width: 560px;
}

.quest-locked .countdown {
    font-size: 2em;
    margin: 20px 0;
    font-weight: 700;
    color: var(--primary);
}

.quest-locked .unlock-note {
    opacity: 0.9;
    margin-bottom: 25px;
}

.quest-locked .found-btn {
    background: var(--primary);
    color: var(--secondary);
    border: none;
    padding: 12px 25px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.quest-locked .found-btn:hover {
    background: var(--secondary);
    color: var(--accent);
    transform: translateY(-2px);
}
  
  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes confettiFall {
    0% { transform: translateY(-100px) rotate(0deg); }
    100% { transform: translateY(100vh) rotate(360deg); }
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .header-section { padding: 80px 15px 40px; }
    .main-content { padding: 15px; }
    .quest-grid { grid-template-columns: 1fr; }
    .mountain-path { height: 100px; }
    .checkpoint-dot { width: 30px; height: 30px; }
    .badges-grid { grid-template-columns: repeat(3, 1fr); }
  }
  
  @media (max-width: 480px) {
    .instructions-grid { grid-template-columns: 1fr; }
    .badges-grid { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <a href="index.html"><i class="fas fa-home"></i> Home</a>
  <a href="schedule.html"><i class="fas fa-calendar-alt"></i> Schedule</a>
  <a href="groups.html"><i class="fas fa-users"></i> Groups</a>
  <a href="quest.html" class="active"><i class="fas fa-compass"></i> Quest</a>
</div>

<!-- Header -->
<div class="header-section">
  <h1><i class="fas fa-mountain"></i> Darjeeling Explorer's Quest</h1>
  <p>Embark on an adventure through the hills! Discover hidden gems and create unforgettable memories.</p>
</div>

<!-- Main Content -->
<div class="main-content">
  <!-- Instructions Section -->
  <div class="instructions-panel">
    <div class="instructions-header">
      <i class="fas fa-info-circle"></i>
      <h3>Quest Instructions & Safety Guide</h3>
    </div>
    <p style="color: var(--text-dark); margin-bottom: 15px;">
      Welcome, explorers! Here's everything you need to know for a safe and exciting adventure:
    </p>
    
    <div class="instructions-grid">
      <div class="instruction-item">
        <i class="fas fa-camera"></i>
        <div>
          <strong>Capture Memories</strong>
          <div style="font-size: 0.9em; color: var(--text-light);">Take photos at each location with your group</div>
        </div>
      </div>
      
      <div class="instruction-item">
        <i class="fas fa-map-marked-alt"></i>
        <div>
          <strong>Use Google Maps</strong>
          <div style="font-size: 0.9em; color: var(--text-light);">Free to use for navigation assistance</div>
        </div>
      </div>
      
      <div class="instruction-item">
        <i class="fas fa-users"></i>
        <div>
          <strong>Stay in Groups</strong>
          <div style="font-size: 0.9em; color: var(--text-light);">Never explore alone - safety first!</div>
        </div>
      </div>
      
      <div class="instruction-item">
        <i class="fas fa-phone-alt"></i>
        <div>
          <strong>Emergency Contacts</strong>
          <div style="font-size: 0.9em; color: var(--text-light);">Contact your group leader if lost</div>
        </div>
      </div>
      
      <div class="instruction-item">
        <i class="fas fa-clock"></i>
        <div>
          <strong>Time Management</strong>
          <div style="font-size: 0.9em; color: var(--text-light);">Complete quests within scheduled time</div>
        </div>
      </div>
      
      <div class="instruction-item">
        <i class="fas fa-heart"></i>
        <div>
          <strong>Have Fun!</strong>
          <div style="font-size: 0.9em; color: var(--text-light);">Enjoy the journey and make new friends</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mountain Progress Visual -->
  <div class="mountain-progress">
    <h3 style="color: var(--secondary); margin-bottom: 10px;">
      <i class="fas fa-mountain"></i> Your Exploration Journey
    </h3>
    <p style="color: var(--text-light); margin-bottom: 15px;">Climb higher with each discovery!</p>
    
    <div class="mountain-path">
      <div class="mountain-base"></div>
      
      <div class="checkpoint" data-level="0">
        <div class="checkpoint-dot">üèÅ</div>
        <div class="checkpoint-label">Start</div>
      </div>
      
      <div class="checkpoint" data-level="1">
        <div class="checkpoint-dot">1</div>
        <div class="checkpoint-label">Hope</div>
      </div>
      
      <div class="checkpoint" data-level="2">
        <div class="checkpoint-dot">2</div>
        <div class="checkpoint-label">Poetry</div>
      </div>
      
      <div class="checkpoint" data-level="3">
        <div class="checkpoint-dot">3</div>
        <div class="checkpoint-label">Peace</div>
      </div>
      
      <div class="checkpoint" data-level="4">
        <div class="checkpoint-dot">4</div>
        <div class="checkpoint-label">Power</div>
      </div>
      
      <div class="checkpoint" data-level="5">
        <div class="checkpoint-dot">5</div>
        <div class="checkpoint-label">Culture</div>
      </div>
      
      <div class="checkpoint" data-level="6">
        <div class="checkpoint-dot">6</div>
        <div class="checkpoint-label">Time</div>
      </div>
      
      <div class="mountain-peak">üèîÔ∏è</div>
    </div>
  </div>

  <!-- Achievement Badges -->
  <div class="badges-section">
    <h3 style="color: var(--secondary); margin-bottom: 10px;">
      <i class="fas fa-trophy"></i> Explorer Badges
    </h3>
    <p style="color: var(--text-light); margin-bottom: 15px;">Unlock achievements as you discover Darjeeling!</p>
    
    <div class="badges-grid" id="badgesGrid">
      <!-- Badges will be populated by JavaScript -->
    </div>
  </div>

  <!-- Quest Cards Grid -->
  <div class="quest-grid" id="questGrid">
    <!-- Cards will be populated by JavaScript -->
  </div>
</div>

<!-- Locked Overlay -->
<div class="quest-locked" id="lockedOverlay" style="display:none">
    <div>
        <h2 style="margin-bottom:8px"><i class="fas fa-lock"></i> Quest Locked</h2>
        <div id="countdownLarge" class="countdown">Loading...</div>
        <div class="unlock-note">This adventure begins on <strong>7 Nov 2025 ‚Äî 2:15 PM IST</strong>. Prepare for an unforgettable journey!</div>
        <button onclick="location.reload()" class="found-btn">
            <i class="fas fa-sync-alt"></i> Refresh when unlocked
        </button>
    </div>
</div>

<script>
/* =========================================================
   Configuration
   ========================================================= */
const TARGET_UNLOCK_ISO_UTC = '2025-11-07T08:45:00Z';
const targetDate = new Date(TARGET_UNLOCK_ISO_UTC);

/* Enhanced Quest Data with Progressive Hints */
const QUEST_POINTS = [
  {
    level: 1,
    title: "The Sign of Hope",
    riddle: `Up the road of cakes and chatter,
Where travellers sip dreams that matter.
A four-letter word shines bright and fine,
Find the place that bakes hope into every line.`,
    hints: [
      "The air smells like coffee and croissants...",
      "Look for a famous bakery on a popular street...",
      "It's Glenary's - find their iconic hope-themed sign!"
    ],
    name: "Glenary's Hope Sign",
    difficulty: "easy",
    badge: "hope-seeker"
  },
  {
    level: 2,
    title: "The Poet Who Spoke for All",
    riddle: `He gave words to gods in a language of men,
The Adikavi's verse still echoes again.
Find the bronze that gazes afar,
Guarding the mall beneath the stars.`,
    hints: [
      "He's the father of Nepali poetry...",
      "Look near the main shopping area...",
      "Find Bhanubhakta's statue watching over the town!"
    ],
    name: "Bhanubhakta Statue",
    difficulty: "easy",
    badge: "poetry-lover"
  },
  {
    level: 3,
    title: "The Whispering Church",
    riddle: `Bells that rang when the British prayed,
Still hum softly where silence stayed.
Go where stained glass meets the pine,
And peace feels almost divine.`,
    hints: [
      "Built in 1843, a quiet colonial church...",
      "Look for beautiful stained glass windows...",
      "Find St. Andrew's Church near the town center!"
    ],
    name: "St. Andrew's Church",
    difficulty: "medium",
    badge: "peace-seeker"
  },
  {
    level: 4,
    title: "The Gate of Governors",
    riddle: `Past winding roads and regal grace,
Stands a gate to a forbidden place.
You can't walk in, but you can admire,
The house where Bengal's powers retire.`,
    hints: [
      "Near Richmond Hill; official summer residence...",
      "Look for impressive gates you can't enter...",
      "Find the Governor's House gate - majestic but closed!"
    ],
    name: "Governor's House Gate",
    difficulty: "medium",
    badge: "power-explorer"
  },
  {
    level: 5,
    title: "The Gate of Colours and Prayers",
    riddle: `A dragon guards, the flags all sway,
Songs of Tibet light your way.
Seek the gate with colors bold,
Where crafts and hearts are centuries old.`,
    hints: [
      "A Tibetan school with traditional motifs...",
      "Look for colorful prayer flags...",
      "Find the Tibetan Refugee Centre's beautiful gate!"
    ],
    name: "Tibetan School Gate",
    difficulty: "hard",
    badge: "culture-discoverer"
  },
  {
    level: 6,
    title: "The Clock of Time and Tales",
    riddle: `Tick-tock echoes through mist and street,
Where footsteps and stories forever meet.
The tower stands, a sentinel tall,
Watching the heart of the town for all.`,
    hints: [
      "An old clock tower near the town square...",
      "Listen for the chimes...",
      "Find Darjeeling's iconic Clock Tower!"
    ],
    name: "Darjeeling Clock Tower",
    difficulty: "hard",
    badge: "time-traveler"
  }
];

/* Achievement Badges Data */
const BADGES = [
  { id: "hope-seeker", name: "Hope Seeker", icon: "üîç", description: "Found the sign of hope" },
  { id: "poetry-lover", name: "Poetry Lover", icon: "üìñ", description: "Discovered the poet's statue" },
  { id: "peace-seeker", name: "Peace Seeker", icon: "üïäÔ∏è", description: "Visited the whispering church" },
  { id: "power-explorer", name: "Power Explorer", icon: "üèõÔ∏è", description: "Found the governor's gate" },
  { id: "culture-discoverer", name: "Culture Discoverer", icon: "üéé", description: "Explored Tibetan heritage" },
  { id: "time-traveler", name: "Time Traveler", icon: "‚è∞", description: "Found the clock tower" },
  { id: "master-explorer", name: "Master Explorer", icon: "üèîÔ∏è", description: "Completed all quests!" }
];

/* Utility Functions */
function maskName(name) {
  let out = '';
  let letterIndex = 0;
  for(let ch of name) {
    if(/[A-Za-z]/.test(ch)) {
      out += (letterIndex % 3 === 0) ? ch : '‚Ä¢';
      letterIndex++;
    } else {
      out += ch;
    }
  }
  return out;
}

function createConfetti() {
  const confetti = document.createElement('div');
  confetti.style.position = 'fixed';
  confetti.style.left = Math.random() * 100 + 'vw';
  confetti.style.top = '-50px';
  confetti.style.fontSize = (Math.random() * 20 + 15) + 'px';
  confetti.style.zIndex = '9999';
  confetti.style.pointerEvents = 'none';
  confetti.textContent = ['üéâ', 'üéä', '‚≠ê', '‚ú®', 'üèÜ', 'üéà'][Math.floor(Math.random() * 6)];
  confetti.style.animation = `confettiFall ${Math.random() * 3 + 2}s linear forwards`;
  document.body.appendChild(confetti);
  
  setTimeout(() => confetti.remove(), 5000);
}

function celebrateCompletion() {
  for(let i = 0; i < 25; i++) {
    setTimeout(() => createConfetti(), i * 100);
  }
}

/* Render Functions */
function renderBadges() {
  const container = document.getElementById('badgesGrid');
  const foundState = JSON.parse(localStorage.getItem('questFound') || '{}');
  const completedQuests = Object.keys(foundState).filter(key => foundState[key]).length;
  
  container.innerHTML = BADGES.map(badge => {
    const isUnlocked = 
      badge.id === 'master-explorer' ? completedQuests === QUEST_POINTS.length :
      QUEST_POINTS.some(q => q.badge === badge.id && foundState[`level_${q.level}`]);
    
    return `
      <div class="badge ${isUnlocked ? 'unlocked' : 'locked'}">
        <span class="badge-icon">${badge.icon}</span>
        <div class="badge-name">${badge.name}</div>
      </div>
    `;
  }).join('');
}

function renderQuestCards() {
  const container = document.getElementById('questGrid');
  container.innerHTML = QUEST_POINTS.map(point => {
    const masked = maskName(point.name);
    return `
      <div class="quest-card" data-level="${point.level}" id="card-${point.level}">
        <div class="card-header">
          <span class="level-number">Level ${point.level}</span>
          <span class="difficulty ${point.difficulty}">${point.difficulty}</span>
        </div>
        
        <div class="quest-title">${point.title}</div>
        
        <div class="riddle-box">
          <div class="riddle">${point.riddle}</div>
        </div>
        
        <div class="hint-system">
          <button class="hint-toggle" onclick="toggleHint(${point.level})">
            <i class="fas fa-lightbulb"></i> Need a hint?
          </button>
          <div class="hint-content" id="hint-${point.level}">
            <div class="hint-level">Hint 1:</div>
            ${point.hints[0]}
          </div>
        </div>
        
        <div class="location-reveal">
          <div class="masked-name" id="masked-${point.level}">${masked}</div>
          <div style="margin-top: 15px;">
            <button class="found-btn" id="btn-${point.level}" onclick="markFound(${point.level})">
              <i class="fas fa-check"></i> I Found It!
            </button>
            <span id="reveal-${point.level}"></span>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

/* Interactive Functions */
function toggleHint(level) {
  const hintContent = document.getElementById(`hint-${level}`);
  const foundState = JSON.parse(localStorage.getItem('questFound') || '{}');
  const hintState = JSON.parse(localStorage.getItem('questHints') || '{}');
  
  if (!foundState[`level_${level}`]) {
    const currentHintLevel = hintState[`level_${level}`] || 0;
    const nextHintLevel = Math.min(currentHintLevel + 1, QUEST_POINTS.find(p => p.level === level).hints.length - 1);
    
    hintState[`level_${level}`] = nextHintLevel;
    localStorage.setItem('questHints', JSON.stringify(hintState));
    
    const point = QUEST_POINTS.find(p => p.level === level);
    hintContent.innerHTML = `
      <div class="hint-level">Hint ${nextHintLevel + 1}:</div>
      ${point.hints[nextHintLevel]}
    `;
  }
  
  hintContent.classList.toggle('show');
}

function markFound(level) {
  const point = QUEST_POINTS.find(p => p.level === level);
  if (!point) return;
  
  // Update UI
  const reveal = document.getElementById(`reveal-${level}`);
  reveal.innerHTML = `<span class="found-badge"><i class="fas fa-check-circle"></i> Discovered!</span>`;
  
  const btn = document.getElementById(`btn-${level}`);
  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-check"></i> Completed!';
  
  const maskedEl = document.getElementById(`masked-${level}`);
  maskedEl.textContent = point.name;
  maskedEl.style.borderColor = 'var(--success)';
  
  const card = document.getElementById(`card-${level}`);
  card.classList.add('found');
  
  // Update progress
  updateProgress();
  
  // Celebrate if this completes all quests
  const foundState = JSON.parse(localStorage.getItem('questFound') || '{}');
  foundState[`level_${level}`] = true;
  localStorage.setItem('questFound', JSON.stringify(foundState));
  
  const completedQuests = Object.keys(foundState).filter(key => foundState[key]).length;
  if (completedQuests === QUEST_POINTS.length) {
    setTimeout(celebrateCompletion, 500);
  }
  
  // Update badges
  renderBadges();
}

function updateProgress() {
  const foundState = JSON.parse(localStorage.getItem('questFound') || '{}');
  
  QUEST_POINTS.forEach(point => {
    const checkpoint = document.querySelector(`.checkpoint[data-level="${point.level}"]`);
    if (checkpoint) {
      checkpoint.classList.remove('active', 'completed');
      if (foundState[`level_${point.level}`]) {
        checkpoint.classList.add('completed');
      } else {
        // Find the first unfinished quest and mark it as active
        const currentLevel = QUEST_POINTS.find(p => !foundState[`level_${p.level}`])?.level || QUEST_POINTS.length;
        if (point.level === currentLevel) {
          checkpoint.classList.add('active');
        }
      }
    }
  });
}

/* State Management */
function restoreState() {
  const foundState = JSON.parse(localStorage.getItem('questFound') || '{}');
  const hintState = JSON.parse(localStorage.getItem('questHints') || '{}');
  
  // Restore found states
  Object.keys(foundState).forEach(key => {
    if (foundState[key]) {
      const level = parseInt(key.split('_')[1]);
      setTimeout(() => {
        const point = QUEST_POINTS.find(p => p.level === level);
        if (point) {
          const btn = document.getElementById(`btn-${level}`);
          const reveal = document.getElementById(`reveal-${level}`);
          const maskedEl = document.getElementById(`masked-${level}`);
          const card = document.getElementById(`card-${level}`);
          
          if (btn) {
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-check"></i> Completed!';
          }
          if (reveal) {
            reveal.innerHTML = `<span class="found-badge"><i class="fas fa-check-circle"></i> Discovered!</span>`;
          }
          if (maskedEl) {
            maskedEl.textContent = point.name;
            maskedEl.style.borderColor = 'var(--success)';
          }
          if (card) {
            card.classList.add('found');
          }
        }
      }, 100);
    }
  });
  
  // Restore hint states
  Object.keys(hintState).forEach(key => {
    const level = parseInt(key.split('_')[1]);
    const hintLevel = hintState[key];
    const point = QUEST_POINTS.find(p => p.level === level);
    
    if (point && hintLevel > 0) {
      const hintContent = document.getElementById(`hint-${level}`);
      if (hintContent) {
        hintContent.innerHTML = `
          <div class="hint-level">Hint ${hintLevel + 1}:</div>
          ${point.hints[hintLevel]}
        `;
      }
    }
  });
}

/* Lock/Unlock Logic */
function updateLockUI() {
  const now = new Date();
  const lockedOverlay = document.getElementById('lockedOverlay');
  const countdownLarge = document.getElementById('countdownLarge');
  
  const diff = targetDate.getTime() - now.getTime();
  if (diff <= 0) {
    lockedOverlay.style.display = 'none';
    return true;
  } else {
    lockedOverlay.style.display = 'flex';
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
    countdownLarge.teSxtContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    return false;
  }
}

/* Initialize */
document.addEventListener('DOMContentLoaded', function() {
  renderQuestCards();
  renderBadges();
  restoreState();
  updateProgress();
  updateLockUI();
  
  setInterval(updateLockUI, 1000);
});
</script>

</body>
</html>